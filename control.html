<!DOCTYPE html>
<html lang="en">
  <title>Ubiot control test</title>

  <head>
    <!-- <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="840985415900-3nmlkp9kbcj1mnekj0pss7bs4tu6fnuj.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script> -->
    <script src="./js/scripts.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <script type="text/javascript">

    // Initialize the Amazon Cognito credentials provider
    AWS.config.region = 'eu-central-1'; // Region
    AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'eu-central-1:00abeafd-83d3-4ccb-9ba5-c5fc5b31af03',
    });

      var state = "00"
      var dynamodb = new AWS.DynamoDB();
      var newer = String(Date.now() - (48 * 60 * 60 * 1000)).substr(0,10)
      var docClient = new AWS.DynamoDB.DocumentClient();
      
      function scanData() {
        console.log("Scanning data..." + "\n");
    
        var params = {
            TableName: "teiDB",
            ProjectionExpression: "#id, date_time, thing_name, thing_status",
            FilterExpression: "#id between :start_id and :end_id",
            ExpressionAttributeNames: {
                "#id": "id_number",
            },
            ExpressionAttributeValues: {
                ":start_id": String(Date.now() - (48 * 60 * 60 * 1000)).substr(0,10),
                ":end_id": "2600000000"
            }
        };
    
        docClient.scan(params, onScan);
    
        function onScan(err, data) {
            if (err) {
                document.getElementById('textarea').innerHTML += "Unable to scan the table: " + "\n" + JSON.stringify(err, undefined, 2);
            }
            
            else {
                // Print all the movies
                data.Items.forEach(function(each) {
                // console.log(each.date_time + ": " + each.id_number + ": " + each.thing_status + ": " + each.thing_name + ": " + "\n");
                if (each.id_number > newer) {
                    newer = each.id_number
                    state = each.thing_status
                }
              });
            }
          }
      }  
    </script>
  </head>

  <meta charset="UTF-8">
  <link rel="icon" type="image/jpg" href="https://pbs.twimg.com/profile_images/971755977488912384/Sm39bJfl_400x400.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <body>

    <!-- Header -->
    <header class="w3-container w3-blue w3-center">
      <h1 class="w3-big">Ubiot control test</h1>
      <div class="w3-right g-signin2" data-onsuccess="onSignIn" data-theme="light"></div>
      <br><br>
      <a class="w3-right" href="#" onclick="signOut();">Log out</a>
    </header>

    <!-- First Grid -->
    <div class="w3-light-grey w3-container">
      <div class="w3-content">
        <div class="w3-third w3-center">
          <br>
        </div>

        <div class="w3-twothird">
          <h2> Try on/off switching!</h2>
          
          <input type="image" alt="ON" src="https://cdn.pixabay.com/photo/2016/06/01/07/41/green-1428507_960_720.png"
            width="150" height="150" onclick="invokeON()"></input>

          <input type="image" alt="OFF" src="https://cdn.picpng.com/button/red-button-button-icon-back-web-56577.png"
            width="150" height="150" onclick="invokeOFF()"></input>

          <input id="scanData" type="button" value="Update" onclick="updateImage();"/>

          <div>
            <input type="image" id="img" src="./images/off.png"
              width="150" height="150"></input>
          </div>

        </div>
      </div>
    </div>

    <div class="w3-container w3-black w3-center w3-opacity w3-padding-8">
        <h1 class="w3-margin w3-xlarge">Keep working!</h1>
    </div>

    <!-- Footer -->
    <footer class="w3-container w3-padding-16 w3-center w3-opacity">  
      <div class="w3-xlarge w3-padding-8">
        <i class="fa fa-facebook-official w3-hover-opacity"></i>
        <i class="fa fa-instagram w3-hover-opacity"></i>
        <i class="fa fa-snapchat w3-hover-opacity"></i>
        <i class="fa fa-pinterest-p w3-hover-opacity"></i>
        <i class="fa fa-twitter w3-hover-opacity"></i>
        <i class="fa fa-linkedin w3-hover-opacity"></i>
    </div>
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
    </footer>

  </body>
</html>
